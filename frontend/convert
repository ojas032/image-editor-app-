<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Convert Image Format Online - HEIC, JPEG, PNG, WebP, SVG Converter | ImageNerd</title>
    <meta name="description" content="Free online image format converter. Convert from any format to any format: HEIC to JPG, PNG to WebP, SVG to PNG, JPEG to PNG, and more. Fast, secure, and easy to use." />
    <link rel="canonical" href="https://www.imagenerd.in/convert.html" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta property="og:title" content="Convert Image Format Online - HEIC, JPEG, PNG, WebP, SVG Converter | ImageNerd" />
    <meta property="og:description" content="Free online image format converter. Convert from any format to any format: HEIC to JPG, PNG to WebP, SVG to PNG, JPEG to PNG, and more." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.imagenerd.in/convert.html" />
    <meta property="og:image" content="https://www.imagenerd.in/icon_bg.png" />
    <meta name="keywords" content="HEIC converter, HEIC to JPG, HEIC to PNG, image converter, convert images online, JPEG to PNG, PNG to WebP, SVG converter, format converter, image format converter, free image converter" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Convert Images Instantly - ImageNerd Format Converter" />
    <meta name="twitter:description" content="Drag and drop any image and convert between HEIC, JPG, PNG, WebP, SVG, GIF, BMP, TIFF, and more—directly in your browser." />
    <meta name="twitter:image" content="https://www.imagenerd.in/icon_bg.png" />
    <link rel="icon" type="image/png" href="icon_bg.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css?v=1.0.3" />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Image Format Converter - ImageNerd",
      "url": "https://www.imagenerd.in/convert.html",
      "description": "Convert HEIC, JPEG, PNG, SVG, WebP, GIF, BMP, and TIFF images in seconds without uploads leaving your browser.",
      "applicationCategory": "MultimediaApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Instant HEIC to JPEG converter",
        "Batch-ready drag and drop workflow",
        "Browser-based privacy with no server uploads",
        "Support for WebP, SVG, GIF, BMP, and TIFF",
        "Automatic metadata cleanup"
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How do I convert HEIC photos to JPG?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Drop your HEIC file into ImageNerd, choose JPG in the format selector, and click convert. The tool renders the new JPG instantly without sending the file to a server."
          }
        },
        {
          "@type": "Question",
          "name": "Can I convert vector SVG files to PNG?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. ImageNerd flattens SVG artwork into high-quality PNG or JPG bitmaps while keeping transparency intact when you choose PNG."
          }
        },
        {
          "@type": "Question",
          "name": "Is the converter secure?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Absolutely. Everything runs client-side, so sensitive product shots and design assets remain on your device. Close the tab and the data is gone."
          }
        }
      ]
    }
    </script>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-94GM9PQBM1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-94GM9PQBM1');
    </script>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="index.html"><img class="brand-mark" src="icon_without_bg.png" alt="ImageNerd logo" /><span class="brand-name">ImageNerd</span></a>
        <nav class="main-nav">
          <!-- <a href="remove-background.html">Remove background</a> -->
          <a href="compress">Compress</a>
          <a href="resize">Resize</a>
          <a href="crop">Crop</a>
          <a href="convert" class="active">Format Converter</a>
        </nav>
        <button class="nav-toggle" aria-label="Toggle menu" aria-expanded="false">☰</button>
      </div>
    </header>

    <main class="container tool-page-container">
      <div class="tool-header">
        <h1>Convert Image Format Online</h1>
        <p class="subtitle">Convert from any format to any format — HEIC, JPEG, PNG, WebP, SVG, GIF, BMP, TIFF and more. Fast, free, and secure.</p>
      </div>

      <div class="card tool-card">
        <div class="upload-area" id="uploadArea">
          <svg class="upload-icon" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />
          </svg>
          <p class="upload-text"><strong>Click to upload</strong> or drag and drop</p>
          <p class="upload-hint">Supports: HEIC, JPEG, JPG, PNG, WebP, SVG, GIF, BMP, TIFF</p>
          <input type="file" id="fileInput" accept=".heic,.heif,.jpg,.jpeg,.png,.webp,.svg,.gif,.bmp,.tiff,.tif" style="display:none" />
        </div>

        <div id="imagePreviewSection" style="display:none;">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="preview-box">
                <h3 class="preview-title">Original Image</h3>
                <div class="preview-container">
                  <img id="originalImage" alt="Original image" />
                </div>
                <div class="image-info" id="originalInfo">
                  <span class="info-label">Format:</span> <span id="originalFormat">-</span> |
                  <span class="info-label">Size:</span> <span id="originalSize">-</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="preview-box">
                <h3 class="preview-title">Converted Image</h3>
                <div class="preview-container" id="convertedPreviewContainer">
                  <img id="convertedImage" alt="Converted image" style="display:none;" />
                  <div class="loading-spinner" id="loadingSpinner" style="display:none;">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Converting...</span>
                    </div>
                    <p class="mt-3">Converting your image...</p>
                  </div>
                </div>
                <div class="image-info" id="convertedInfo" style="display:none;">
                  <span class="info-label">Format:</span> <span id="convertedFormat">-</span> |
                  <span class="info-label">Size:</span> <span id="convertedSize">-</span>
                </div>
              </div>
            </div>
          </div>

          <div class="controls-section mt-4">
            <div class="row align-items-end g-3">
              <div class="col-md-6">
                <label for="targetFormat" class="form-label fw-semibold">Convert to Format:</label>
                <select id="targetFormat" class="form-select form-select-lg">
                  <option value="jpeg">JPEG / JPG</option>
                  <option value="png">PNG</option>
                  <option value="webp">WebP</option>
                  <option value="gif">GIF</option>
                  <option value="bmp">BMP</option>
                  <option value="tiff">TIFF</option>
                </select>
                <small class="form-text text-muted mt-1 d-block">Choose your desired output format</small>
              </div>

              <div class="col-md-6">
                <button id="convertBtn" class="btn btn-primary btn-lg w-100" type="button">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <path d="M8 3h8M16 3l-3 3 3 3M16 21H8M8 21l3-3-3-3" />
                  </svg>
                  Convert Image
                </button>
              </div>
            </div>
          </div>

          <div class="actions-section mt-4" id="downloadSection" style="display:none;">
            <div class="d-flex gap-3 flex-wrap">
              <button id="downloadBtn" class="btn btn-success btn-lg" type="button">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                </svg>
                Download Converted Image
              </button>
              <button id="convertAnotherBtn" class="btn btn-outline-primary btn-lg" type="button">
                Convert Another Image
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- SEO Content Section -->
      <div class="seo-content mt-5">
        <section class="mb-5">
          <h2>Convert From Any Format to Any Format</h2>
          <p>ImageNerd's free online image converter lets you convert between all popular image formats instantly. Whether you need to convert HEIC to JPG, PNG to WebP, SVG to PNG, or any other combination, our tool makes it simple and fast.</p>
        </section>

        <section class="mb-5">
          <h2>Popular Image Format Conversions</h2>
          <div class="row g-4">
            <div class="col-md-6">
              <h3 class="h5">HEIC to JPG Converter</h3>
              <p>Convert iPhone photos (HEIC/HEIF format) to widely compatible JPG/JPEG format. Perfect for sharing Apple photos on any device or platform.</p>
            </div>
            <div class="col-md-6">
              <h3 class="h5">HEIC to PNG Converter</h3>
              <p>Convert HEIC images to PNG format with transparency support. Ideal for graphics and images requiring lossless quality.</p>
            </div>
            <div class="col-md-6">
              <h3 class="h5">PNG to WebP Converter</h3>
              <p>Convert PNG images to modern WebP format for faster website loading and reduced file sizes without quality loss.</p>
            </div>
            <div class="col-md-6">
              <h3 class="h5">JPEG to PNG Converter</h3>
              <p>Convert JPEG/JPG images to PNG format when you need transparency support or lossless compression.</p>
            </div>
            <div class="col-md-6">
              <h3 class="h5">SVG Converter</h3>
              <p>Convert vector SVG images to raster formats like PNG, JPG, or WebP for broader compatibility.</p>
            </div>
            <div class="col-md-6">
              <h3 class="h5">WebP Converter</h3>
              <p>Convert to or from WebP format for optimal web performance and modern browser compatibility.</p>
            </div>
          </div>
        </section>

        <section class="mb-5">
          <h2>Supported Image Formats</h2>
          <ul class="list-unstyled row g-3">
            <li class="col-md-6"><strong>HEIC/HEIF:</strong> Apple's High Efficiency Image Format used by iPhone and iPad</li>
            <li class="col-md-6"><strong>JPEG/JPG:</strong> Most common image format, ideal for photos</li>
            <li class="col-md-6"><strong>PNG:</strong> Lossless format with transparency support</li>
            <li class="col-md-6"><strong>WebP:</strong> Modern format with excellent compression and quality</li>
            <li class="col-md-6"><strong>GIF:</strong> Animation and simple graphics format</li>
            <li class="col-md-6"><strong>BMP:</strong> Uncompressed bitmap image format</li>
            <li class="col-md-6"><strong>TIFF:</strong> High-quality format for professional photography</li>
            <li class="col-md-6"><strong>SVG:</strong> Scalable vector graphics format</li>
          </ul>
        </section>

        <section class="mb-5">
          <h2>Why Use ImageNerd's Format Converter?</h2>
          <ul>
            <li><strong>Universal Compatibility:</strong> Convert between any supported format with just a few clicks</li>
            <li><strong>HEIC Support:</strong> Full support for Apple's HEIC/HEIF format from iPhone and iPad</li>
            <li><strong>Fast & Free:</strong> Instant conversions with no registration or payment required</li>
            <li><strong>Privacy First:</strong> All conversions happen in your browser - your images never leave your device</li>
            <li><strong>High Quality:</strong> Maintains maximum image quality during conversion</li>
            <li><strong>No Watermarks:</strong> Download your converted images without any branding or watermarks</li>
          </ul>
        </section>

        <section class="mb-5">
          <h2>How to Convert Image Formats</h2>
          <ol>
            <li><strong>Upload Your Image:</strong> Click the upload area or drag and drop your image file (HEIC, JPEG, PNG, SVG, WebP, GIF, BMP, or TIFF)</li>
            <li><strong>Choose Output Format:</strong> Select your desired output format from the dropdown menu</li>
            <li><strong>Convert:</strong> Click the "Convert Image" button to process your image</li>
            <li><strong>Download:</strong> Download your converted image in the new format</li>
          </ol>
        </section>

        <section>
          <h2>Frequently Asked Questions</h2>
          <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                  How do I convert HEIC to JPG?
                </button>
              </h3>
              <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  Upload your HEIC file, select "JPEG / JPG" as the output format, click "Convert Image", and download your converted JPG file. It's that simple!
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                  Is the image converter really free?
                </button>
              </h3>
              <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  Yes! ImageNerd's format converter is completely free with no limits, watermarks, or registration required.
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                  Are my images safe when converting?
                </button>
              </h3>
              <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  Absolutely! All image conversions happen directly in your browser. Your images are never uploaded to our servers, ensuring complete privacy and security.
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                  What's the best format to convert to?
                </button>
              </h3>
              <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  It depends on your needs: Use JPEG for photos and general use, PNG for images needing transparency, WebP for web optimization, and GIF for animations. HEIC to JPG conversion is ideal for sharing Apple photos universally.
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="mb-5">
          <h2>Expert Tips for Pixel-Perfect Conversions</h2>
          <p>Plan around the destination before you convert. Choose JPG for lifelike photography, PNG for transparency and UI elements, WebP to balance compression with clarity, and keep SVGs when you need infinitely scalable logos. Publishing interface assets? Export @2x or @3x versions so high-density displays stay tack sharp.</p>
          <p>After you generate new files, pass them through the <a href="https://www.imagenerd.in/compress">ImageNerd compressor</a> or <a href="https://www.imagenerd.in/resize">image resizer</a> to fine-tune size and dimensions, then rename each output with descriptive keywords like <code>landing-page-hero-1600.webp</code>. That workflow improves digital asset management, reduces duplicate-content risk, and helps search engines understand how each version is unique.</p>
        </section>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
          <p>© <span id="year"></span> ImageNerd. All rights reserved.</p>
          <nav style="display: flex; gap: 16px; flex-wrap: wrap;">
            <a href="about" style="color: var(--light-muted); text-decoration: none;">About Us</a>
            <a href="contact" style="color: var(--light-muted); text-decoration: none;">Contact Us</a>
            <a href="privacy" style="color: var(--light-muted); text-decoration: none;">Privacy Policy</a>
            <a href="terms" style="color: var(--light-muted); text-decoration: none;">Terms</a>
          </nav>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="script.js?v=1.0.9"></script>
    
    <!-- Hide header/footer when loaded in iframe -->
    <script>
      if (window.self !== window.top) {
        // We're in an iframe, hide header and footer
        const header = document.querySelector('.site-header');
        const footer = document.querySelector('.site-footer');
        if (header) header.style.display = 'none';
        if (footer) footer.style.display = 'none';
        // Adjust main padding since header is hidden
        const main = document.querySelector('main');
        if (main) main.style.paddingTop = '20px';
      }
    </script>
    
    <script>
      // Convert page functionality
      let originalImageData = null;
      let originalFileName = '';
      let originalFormat = '';
      let convertedImageBlob = null;

      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const imagePreviewSection = document.getElementById('imagePreviewSection');
      const originalImage = document.getElementById('originalImage');
      const convertedImage = document.getElementById('convertedImage');
      const loadingSpinner = document.getElementById('loadingSpinner');
      const convertBtn = document.getElementById('convertBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const downloadSection = document.getElementById('downloadSection');
      const convertAnotherBtn = document.getElementById('convertAnotherBtn');
      const targetFormat = document.getElementById('targetFormat');

      // Upload area click handler
      uploadArea.addEventListener('click', () => fileInput.click());

      // Drag and drop handlers
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = 'var(--accent)';
        uploadArea.style.background = 'var(--accent-bg)';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '';
        uploadArea.style.background = '';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '';
        uploadArea.style.background = '';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileUpload(files[0]);
        }
      });

      // File input change handler
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileUpload(e.target.files[0]);
        }
      });

      // Handle file upload
      async function handleFileUpload(file) {
        originalFileName = file.name;
        const fileExtension = file.name.split('.').pop().toLowerCase();
        originalFormat = getFormatFromExtension(fileExtension);

        // Check if it's a HEIC file
        if (fileExtension === 'heic' || fileExtension === 'heif') {
          // For HEIC files, we need to convert them using canvas
          handleHEICFile(file);
        } else {
          const normalized = await normalizeImageFile(file);
          originalImageData = normalized.dataUrl;
          originalImage.src = normalized.dataUrl;
          
          // Update UI
          uploadArea.style.display = 'none';
          imagePreviewSection.style.display = 'block';
          downloadSection.style.display = 'none';
          convertedImage.style.display = 'none';
          document.getElementById('convertedInfo').style.display = 'none';
          
          // Update original image info
          document.getElementById('originalFormat').textContent = originalFormat.toUpperCase();
          document.getElementById('originalSize').textContent = formatFileSize(file.size);
        }
      }
      
      // Normalize image orientation and return dataUrl/base64
      async function normalizeImageFile(file) {
        if (window.createImageBitmap) {
          try {
            const bitmap = await createImageBitmap(file, { imageOrientation: 'from-image' });
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = bitmap.width;
            canvas.height = bitmap.height;
            ctx.drawImage(bitmap, 0, 0);
            const dataUrl = canvas.toDataURL(file.type || 'image/jpeg', 0.95);
            bitmap.close && bitmap.close();
            return {
              base64: dataUrl.split(',')[1],
              dataUrl,
              width: canvas.width,
              height: canvas.height
            };
          } catch (err) {
            console.warn('createImageBitmap orientation failed', err);
          }
        }
        return await normalizeWithCanvas(file);
      }

      async function normalizeWithCanvas(file) {
        const orientation = await readExifOrientation(file);
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              const width = img.width;
              const height = img.height;

              if (orientation > 4 && orientation < 9) {
                canvas.width = height;
                canvas.height = width;
              } else {
                canvas.width = width;
                canvas.height = height;
              }

              switch (orientation) {
                case 2: ctx.transform(-1, 0, 0, 1, width, 0); break;
                case 3: ctx.transform(-1, 0, 0, -1, width, height); break;
                case 4: ctx.transform(1, 0, 0, -1, 0, height); break;
                case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;
                case 6: ctx.transform(0, 1, -1, 0, height, 0); break;
                case 7: ctx.transform(0, -1, -1, 0, height, width); break;
                case 8: ctx.transform(0, -1, 1, 0, 0, width); break;
              }

              ctx.drawImage(img, 0, 0);
              const dataUrl = canvas.toDataURL(file.type || 'image/jpeg', 0.95);
              resolve({
                base64: dataUrl.split(',')[1],
                dataUrl,
                width: canvas.width,
                height: canvas.height
              });
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        });
      }

      function readExifOrientation(file) {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const view = new DataView(e.target.result);
            if (view.getUint16(0, false) !== 0xFFD8) {
              resolve(1);
              return;
            }
            const length = view.byteLength;
            let offset = 2;
            while (offset < length) {
              if (view.getUint16(offset + 2, false) <= 8) break;
              const marker = view.getUint16(offset, false);
              offset += 2;
              if (marker === 0xFFE1) {
                if (view.getUint32(offset += 2, false) !== 0x45786966) break;
                const little = view.getUint16(offset += 6, false) === 0x4949;
                offset += view.getUint32(offset + 4, little);
                const tags = view.getUint16(offset, little);
                offset += 2;
                for (let i = 0; i < tags; i++) {
                  if (view.getUint16(offset + (i * 12), little) === 0x0112) {
                    resolve(view.getUint16(offset + (i * 12) + 8, little));
                    return;
                  }
                }
              } else if ((marker & 0xFF00) !== 0xFF00) {
                break;
              } else {
                offset += view.getUint16(offset, false);
              }
            }
            resolve(1);
          };
          reader.readAsArrayBuffer(file);
        });
      }

      // Handle HEIC files by converting to PNG first
      async function handleHEICFile(file) {
        try {
          // Show loading state
          uploadArea.innerHTML = '<div class="loading-spinner" style="display:flex;"><div class="spinner-border text-primary" role="status"></div><p class="mt-3">Converting HEIC image...</p></div>';
          
          // Use heic2any library to convert HEIC to PNG
          let convertedBlob;
          if (typeof heic2any !== 'undefined') {
            // Use heic2any library for better compatibility
            convertedBlob = await heic2any({
              blob: file,
              toType: 'image/png',
              quality: 1
            });
            
            // Handle array of blobs (heic2any might return array)
            if (Array.isArray(convertedBlob)) {
              convertedBlob = convertedBlob[0];
            }
          } else {
            // Fallback: try browser native support
            convertedBlob = await convertHEICNatively(file);
          }
          
          // Read the converted blob as data URL
          const reader = new FileReader();
          reader.onload = function(e) {
            originalImageData = e.target.result;
            originalImage.src = originalImageData;
            
            // Restore upload area HTML
            uploadArea.innerHTML = `
              <svg class="upload-icon" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />
              </svg>
              <p class="upload-text"><strong>Click to upload</strong> or drag and drop</p>
              <p class="upload-hint">Supports: HEIC, JPEG, JPG, PNG, WebP, SVG, GIF, BMP, TIFF</p>
            `;
            
            // Update UI
            uploadArea.style.display = 'none';
            imagePreviewSection.style.display = 'block';
            downloadSection.style.display = 'none';
            convertedImage.style.display = 'none';
            document.getElementById('convertedInfo').style.display = 'none';
            
            // Update original image info
            document.getElementById('originalFormat').textContent = 'HEIC';
            document.getElementById('originalSize').textContent = formatFileSize(file.size);
          };
          reader.readAsDataURL(convertedBlob);
          
        } catch (error) {
          console.error('HEIC conversion error:', error);
          
          // Restore upload area HTML
          uploadArea.innerHTML = `
            <svg class="upload-icon" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />
            </svg>
            <p class="upload-text"><strong>Click to upload</strong> or drag and drop</p>
            <p class="upload-hint">Supports: HEIC, JPEG, JPG, PNG, WebP, SVG, GIF, BMP, TIFF</p>
          `;
          
          alert('Failed to convert HEIC image. Please try:\n1. Using Safari or Chrome on macOS/iOS\n2. Converting the HEIC file to JPG first\n3. Using a different image');
        }
      }

      // Fallback function for native HEIC support
      function convertHEICNatively(file) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          const url = URL.createObjectURL(file);
          
          img.onload = function() {
            // Create canvas to convert HEIC to PNG
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            
            // Convert canvas to blob
            canvas.toBlob(function(blob) {
              URL.revokeObjectURL(url);
              if (blob) {
                resolve(blob);
              } else {
                reject(new Error('Failed to create blob from canvas'));
              }
            }, 'image/png');
          };
          
          img.onerror = function() {
            URL.revokeObjectURL(url);
            reject(new Error('Browser does not support HEIC format natively'));
          };
          
          img.src = url;
        });
      }

      // Convert button handler
      convertBtn.addEventListener('click', async () => {
        if (!originalImageData) {
          alert('Please upload an image first');
          return;
        }

        const format = targetFormat.value;
        
        // Show loading state
        loadingSpinner.style.display = 'flex';
        convertedImage.style.display = 'none';
        convertBtn.disabled = true;
        document.getElementById('convertedInfo').style.display = 'none';

        try {
          // Extract base64 data
          const base64Data = originalImageData.split(',')[1];

          // Call backend API
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 20000);

          const response = await fetch('https://api.imagenerd.in/convert', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              image_base64: base64Data,
              format: format
            }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Conversion failed');
          }

          const data = await response.json();
          const convertedBase64 = data.converted_image_base64;
          
          // Create image blob and display
          const mimeType = getMimeType(format);
          const blob = base64ToBlob(convertedBase64, mimeType);
          convertedImageBlob = blob;
          
          const imageUrl = URL.createObjectURL(blob);
          convertedImage.src = imageUrl;
          convertedImage.style.display = 'block';
          loadingSpinner.style.display = 'none';
          
          // Update converted image info
          document.getElementById('convertedFormat').textContent = format.toUpperCase();
          document.getElementById('convertedSize').textContent = formatFileSize(blob.size);
          document.getElementById('convertedInfo').style.display = 'block';
          
          // Show download section
          downloadSection.style.display = 'block';
        } catch (error) {
          console.error('Conversion error:', error);
          if (error.name === 'AbortError') {
            alert('Request timed out after 20 seconds. Please try again.');
          } else {
            alert('Failed to convert image: ' + error.message);
          }
          loadingSpinner.style.display = 'none';
        } finally {
          convertBtn.disabled = false;
        }
      });

      // Download button handler
      downloadBtn.addEventListener('click', () => {
        if (!convertedImageBlob) {
          alert('No converted image available');
          return;
        }

        const format = targetFormat.value;
        const extension = format === 'jpeg' ? 'jpg' : format;
        const baseFileName = originalFileName.replace(/\.[^/.]+$/, '');
        const fileName = `${baseFileName}_converted.${extension}`;

        const url = URL.createObjectURL(convertedImageBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      // Convert another button handler
      convertAnotherBtn.addEventListener('click', () => {
        uploadArea.style.display = 'flex';
        imagePreviewSection.style.display = 'none';
        fileInput.value = '';
        originalImageData = null;
        convertedImageBlob = null;
      });

      // Helper functions
      function getFormatFromExtension(ext) {
        const formatMap = {
          'jpg': 'jpeg',
          'jpeg': 'jpeg',
          'png': 'png',
          'webp': 'webp',
          'gif': 'gif',
          'bmp': 'bmp',
          'tiff': 'tiff',
          'tif': 'tiff',
          'heic': 'heic',
          'heif': 'heic',
          'svg': 'svg'
        };
        return formatMap[ext] || ext;
      }

      function getMimeType(format) {
        const mimeMap = {
          'jpeg': 'image/jpeg',
          'png': 'image/png',
          'webp': 'image/webp',
          'gif': 'image/gif',
          'bmp': 'image/bmp',
          'tiff': 'image/tiff',
          'heic': 'image/heic'
        };
        return mimeMap[format] || 'image/jpeg';
      }

      function base64ToBlob(base64, mimeType) {
        const byteCharacters = atob(base64);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        return new Blob([byteArray], { type: mimeType });
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'MB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
      }
    </script>
  </body>
</html>
