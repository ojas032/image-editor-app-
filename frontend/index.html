<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ImageNerd â€” Fast Online Image Tools</title>
    <meta name="description" content="ImageNerd lets you compress, resize, crop, and convert images online â€” fast and free." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css" />
    <style>
      /* SPA Router styles */
      .view { display: none; }
      .view.active { display: block; }
      .main-nav a.active { color: var(--text-100); text-decoration: underline; }
      
      /* Compress/Resize/Crop card styles */
      .compress-card, .resize-card, .crop-card, .convert-card {
        border: 1px solid var(--light-border);
        background: var(--light-card);
        border-radius: 14px;
        padding: 28px;
      }
      
      .compress-uploader, .resize-uploader, .crop-uploader {
        border: 2px dashed var(--light-border);
        border-radius: 12px;
        padding: 32px;
        text-align: center;
        background: rgba(15,23,42,0.02);
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .compress-uploader:hover, .resize-uploader:hover, .crop-uploader:hover {
        border-color: var(--primary-500);
        background: rgba(91, 140, 255, 0.03);
      }
      
      .compress-uploader.drag, .resize-uploader.drag, .crop-uploader.drag {
        background: rgba(91,140,255,0.10);
        border-color: #a5b4fc;
      }
      
      .compress-help, .resize-help, .crop-help {
        margin-top: 10px;
        color: var(--light-muted);
        font-size: 14px;
      }
      
      .resize-settings, .compress-controls, .crop-settings {
        background: rgba(15,23,42,0.02);
        border: 1px solid var(--light-border);
        border-radius: 12px;
        padding: 28px;
        margin-top: 24px;
      }
      
      .form-control, .form-select {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        color: #0b1220;
        padding: 8px 12px;
        border-radius: 6px;
        width: 100%;
      }
      
      .form-control:focus, .form-select:focus {
        border-color: var(--primary-500);
        box-shadow: 0 0 0 0.2rem rgba(91,140,255,0.25);
        outline: none;
      }
      
      .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
        color: var(--light-text);
      }
      
      .form-check-input {
        margin-right: 8px;
      }
      
      .form-check-label {
        font-weight: 600;
      }
      
      /* Animation */
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Dark theme overrides */
      .theme-dark .compress-card,
      .theme-dark .resize-card,
      .theme-dark .crop-card,
      .theme-dark .convert-card {
        border-color: var(--border-700);
        background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      }
      
      .theme-dark .compress-uploader,
      .theme-dark .resize-uploader,
      .theme-dark .crop-uploader {
        border-color: var(--border-700);
        background: rgba(255,255,255,0.02);
      }
      
      .theme-dark .compress-uploader:hover,
      .theme-dark .resize-uploader:hover,
      .theme-dark .crop-uploader:hover {
        border-color: var(--primary-500);
        background: rgba(91, 140, 255, 0.08);
      }
      
      .theme-dark .compress-uploader.drag,
      .theme-dark .resize-uploader.drag,
      .theme-dark .crop-uploader.drag {
        background: rgba(91,140,255,0.15);
        border-color: #5b8cff;
      }
      
      .theme-dark .compress-help,
      .theme-dark .resize-help,
      .theme-dark .crop-help {
        color: var(--text-300);
      }
      
      .theme-dark .resize-settings,
      .theme-dark .compress-controls,
      .theme-dark .crop-settings {
        background: rgba(255,255,255,0.02);
        border-color: var(--border-700);
      }
      
      .theme-dark .form-control,
      .theme-dark .form-select {
        background: rgba(255,255,255,0.05);
        border-color: var(--border-700);
        color: var(--text-100);
      }
      
      .theme-dark .form-control:focus,
      .theme-dark .form-select:focus {
        background: rgba(255,255,255,0.08);
        border-color: var(--primary-500);
        color: var(--text-100);
      }
      
      .theme-dark .form-label {
        color: var(--text-100);
      }
      
      .theme-dark .form-check-label {
        color: var(--text-100);
      }
      
      .theme-dark img {
        border-color: var(--border-700);
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="#" onclick="router.navigate('home'); return false;" aria-label="ImageNerd Home">
          <span class="brand-mark" aria-hidden="true">ðŸ§ </span>
          <span class="brand-name">ImageNerd</span>
        </a>
        <nav class="main-nav" aria-label="Primary">
          <!-- Remove background hidden -->
          <a href="#compress" data-route="compress">Compress</a>
          <a href="#resize" data-route="resize">Resize</a>
          <a href="/crop">Crop</a>
          <a href="/convert">Format Converter</a>
        </nav>
        <div class="header-cta">
          <button id="themeToggle" class="btn btn-ghost" type="button">Toggle theme</button>
        </div>
        <button class="nav-toggle" aria-label="Toggle menu" aria-expanded="false">â˜°</button>
      </div>
    </header>

    <main>
      <!-- HOME VIEW -->
      <div id="view-home" class="view active">
        <section class="hero">
          <div class="container hero-inner">
            <h1>Powerful image tools, zero friction</h1>
            <p class="subtitle">Compress, resize, crop, and convert images â€” right in your browser.</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="#compress">Compress image</a>
              <a class="btn btn-ghost" href="#resize">Resize image</a>
            </div>
          </div>
        </section>

        <section class="features-grid container" aria-label="Popular tools">
          <!-- Remove background feature hidden -->
          
          <a class="feature" href="#compress">
            <span class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8 3v4M8 17v4" />
                <path d="M5 8h6M5 16h6" />
                <path d="M16 8l3 4-3 4" />
              </svg>
            </span>
            <div class="feature-copy">
              <h3>Compress image</h3>
              <p>Shrink file sizes without losing visible quality.</p>
            </div>
          </a>

          <a class="feature" href="#resize">
            <span class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 10V3h7" />
                <path d="M21 14v7h-7" />
                <path d="M3 3l8 8M13 13l8 8" />
              </svg>
            </span>
            <div class="feature-copy">
              <h3>Resize image</h3>
              <p>Exact dimensions for web, social, and print.</p>
            </div>
          </a>

          <a class="feature" href="/crop">
            <span class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M7 3v14a3 3 0 003 3h14" />
                <path d="M3 7h14a3 3 0 013 3v14" />
              </svg>
            </span>
            <div class="feature-copy">
              <h3>Crop image</h3>
              <p>Frame perfectly with aspect-ratio presets.</p>
            </div>
          </a>

          <a class="feature" href="/convert">
            <span class="feature-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8 3h8" />
                <path d="M16 3l-3 3 3 3" />
                <path d="M16 21H8" />
                <path d="M8 21l3-3-3-3" />
              </svg>
            </span>
            <div class="feature-copy">
              <h3>Convert format</h3>
              <p>JPG, PNG, WEBP, SVG, and more in seconds.</p>
            </div>
          </a>
        </section>
      </div>

      <!-- COMPRESS VIEW -->
      <div id="view-compress" class="view">
        <div class="container" style="padding:32px 0 56px;">
          <h1>Compress image</h1>
          <p class="subtitle">Reduce file size while maintaining quality. Perfect for web optimization.</p>
          <section id="compressSection" aria-label="Image compressor" style="margin-top:24px;"></section>
        </div>
      </div>

      <!-- RESIZE VIEW -->
      <div id="view-resize" class="view">
        <div class="container" style="padding:32px 0 56px;">
          <h1>Resize Image Online</h1>
          <p class="subtitle">Resize images for YouTube thumbnails, Instagram posts, Instagram Reels, Facebook, Twitter, and all social media platforms. Free, fast, and easy.</p>
          <section id="resizeSection" aria-label="Image resizer" style="margin-top:24px;"></section>
        </div>
      </div>

      <!-- CROP VIEW -->
      <div id="view-crop" class="view">
        <div class="container" style="padding:32px 0 56px;">
          <h1>Crop Image Online</h1>
          <p class="subtitle">Crop images precisely with visual controls or manual dimensions. Perfect for social media, profile pictures, and custom sizes. Free, fast, and easy.</p>
          <section id="cropSection" aria-label="Image cropper" style="margin-top:24px;"></section>
        </div>
      </div>

      <!-- CONVERT VIEW -->
      <div id="view-convert" class="view">
        <div class="container" style="padding:32px 0 56px;">
          <div class="tool-header">
            <h1>Convert Image Format Online</h1>
            <p class="subtitle">Convert from any format to any format â€” HEIC, JPEG, PNG, WebP, SVG, GIF, BMP, TIFF and more. Fast, free, and secure.</p>
          </div>
          <div id="convertSection" aria-label="Image converter" style="margin-top:24px;"></div>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p>Â© <span id="year"></span> ImageNerd. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="router.js"></script>
    <script src="script.js"></script>
    
    <script>
      // Router system
      const router = {
        currentView: 'home',
        
        navigate(view) {
          // Hide all views
          document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
          
          // Update nav active state
          document.querySelectorAll('.main-nav a').forEach(a => a.classList.remove('active'));
          
          // Show selected view
          const viewEl = document.getElementById('view-' + view);
          if (viewEl) {
            viewEl.classList.add('active');
            this.currentView = view;
            
            // Update nav active
            const navLink = document.querySelector(`.main-nav a[data-route="${view}"]`);
            if (navLink) navLink.classList.add('active');
            
            // Initialize view if needed
            if (view === 'compress' && !window.compressInitialized) {
              initCompressView();
            } else if (view === 'resize' && !window.resizeInitialized) {
              initResizeView();
            } else if (view === 'crop' && !window.cropInitialized) {
              initCropView();
            } else if (view === 'convert' && !window.convertInitialized) {
              initConvertView();
            }
          }
        }
      };

      // Handle hash changes
      window.addEventListener('hashchange', () => {
        const hash = window.location.hash.slice(1);
        if (hash) {
          router.navigate(hash);
        } else {
          router.navigate('home');
        }
      });

      // Handle clicks on hash links
      document.addEventListener('click', (e) => {
        const link = e.target.closest('a[href^="#"]');
        if (link) {
          e.preventDefault();
          const hash = link.getAttribute('href').slice(1);
          if (hash) {
            window.location.hash = hash;
          } else {
            window.location.hash = '';
          }
        }
      });

      // Initial route
      const initialHash = window.location.hash.slice(1);
      if (initialHash && ['compress', 'resize', 'crop', 'convert'].includes(initialHash)) {
        router.navigate(initialHash);
      }

      // Utility: Fetch with timeout
      async function fetchWithTimeout(url, options = {}, timeout = 20000) {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), timeout);
        
        try {
          const response = await fetch(url, {
            ...options,
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          return response;
        } catch (error) {
          clearTimeout(timeoutId);
          if (error.name === 'AbortError') {
            throw new Error('Request timed out after 20 seconds. Please try again.');
          }
          throw error;
        }
      }

      // ========== COMPRESS VIEW ==========
      function initCompressView() {
        window.compressInitialized = true;
        const section = document.getElementById('compressSection');
        section.innerHTML = `
          <div class="compress-card" role="region" aria-live="polite">
            <div class="compress-uploader" id="compress-dropZone">
              <input id="compress-fileInput" type="file" accept="image/*" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px" aria-hidden="true" />
              <button class="btn btn-primary" id="compress-selectBtn" type="button">Select image</button>
              <div class="compress-help">or drop image here</div>
            </div>
            <div id="compress-editorView" style="display:none;max-width:700px;margin:0 auto;text-align:center;">
              <div id="compress-processingOverlay" style="display:flex;flex-direction:column;align-items:center;padding:40px;">
                <div style="display:inline-block;width:48px;height:48px;border:4px solid var(--primary-500);border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:16px"></div>
                <div style="font-weight:600;font-size:18px;color:var(--light-text);">Compressing your image...</div>
              </div>
              <div id="compress-successView" style="display:none;">
                <div style="background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:#fff;border-radius:12px;padding:32px;margin-bottom:24px;">
                  <div style="font-size:20px;font-weight:600;margin-bottom:8px;">âœ“ Saved</div>
                  <div style="font-size:32px;font-weight:700;margin-bottom:16px;">Your image is now <span id="compress-reductionPercent">82</span>% smaller!</div>
                  <div style="font-size:18px;opacity:0.9;">
                    <span id="compress-originalSizeDisplay">818.94 KB</span> â†’ <span id="compress-compressedSizeDisplay">148.47 KB</span>
                  </div>
                </div>
                <div style="margin-bottom:24px;">
                  <img id="compress-compressedImg" src="" alt="Compressed" style="max-width:100%;max-height:400px;border:1px solid var(--light-border);border-radius:8px;" />
                </div>
                <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
                  <a class="btn btn-primary" id="compress-downloadBtn" href="#" download style="font-size:16px;padding:12px 24px;">Download Image</a>
                  <button class="btn btn-ghost" id="compress-changeImageBtn" type="button" style="font-size:16px;padding:12px 24px;">Compress Another</button>
                </div>
              </div>
            </div>
          </div>
        `;

        // Compress functionality
        const API_BASE = 'https://api.imagenerd.in';
        const fileInput = document.getElementById('compress-fileInput');
        const selectBtn = document.getElementById('compress-selectBtn');
        const dropZone = document.getElementById('compress-dropZone');
        const editorView = document.getElementById('compress-editorView');
        const processingOverlay = document.getElementById('compress-processingOverlay');
        const successView = document.getElementById('compress-successView');
        const compressedImg = document.getElementById('compress-compressedImg');
        const changeImageBtn = document.getElementById('compress-changeImageBtn');
        const downloadBtn = document.getElementById('compress-downloadBtn');
        const reductionPercent = document.getElementById('compress-reductionPercent');
        const originalSizeDisplay = document.getElementById('compress-originalSizeDisplay');
        const compressedSizeDisplay = document.getElementById('compress-compressedSizeDisplay');

        let currentFile = null;
        let currentBase64 = '';
        let originalFileSize = 0;

        selectBtn.addEventListener('click', () => fileInput.click());
        changeImageBtn.addEventListener('click', () => {
          dropZone.style.display = 'block';
          editorView.style.display = 'none';
          successView.style.display = 'none';
          fileInput.value = '';
        });

        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag'));
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', () => handleFiles(fileInput.files));

        function handleFiles(list) {
          const files = Array.from(list || []).filter(f => /^image\//.test(f.type));
          if (!files.length) return;
          processFile(files[0]);
        }

        async function processFile(file) {
          currentFile = file;
          originalFileSize = file.size;
          currentBase64 = await fileToBase64(file);
          dropZone.style.display = 'none';
          editorView.style.display = 'block';
          processingOverlay.style.display = 'flex';
          successView.style.display = 'none';
          compressImage();
        }

        function fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(String(reader.result).split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        function formatFileSize(bytes) {
          if (bytes < 1024) return bytes + ' B';
          if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
          return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        async function compressImage() {
          if (!currentBase64) return;
          try {
            const isPNG = currentFile.type.includes('png');
            const body = { image_base64: currentBase64, quality: 88 };
            if (isPNG) body.format = 'jpeg';

            const res = await fetchWithTimeout(API_BASE + '/compress', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body)
            });

            const data = await res.json();
            if (!data.compressed_image_base64) throw new Error(data.error || 'Compression failed');

            const compressedSize = Math.round((data.compressed_image_base64.length * 3) / 4);
            const reduction = ((originalFileSize - compressedSize) / originalFileSize * 100).toFixed(0);

            if (compressedSize >= originalFileSize) {
              throw new Error('Unable to reduce file size. The image may already be optimized.');
            }

            const outputFormat = body.format || (isPNG ? 'png' : 'jpeg');
            const mimeType = outputFormat === 'jpeg' ? 'image/jpeg' : 'image/png';
            const fileExt = outputFormat === 'jpeg' ? 'jpg' : 'png';
            const downloadUrl = `data:${mimeType};base64,${data.compressed_image_base64}`;
            compressedImg.src = downloadUrl;
            reductionPercent.textContent = reduction;
            originalSizeDisplay.textContent = formatFileSize(originalFileSize);
            compressedSizeDisplay.textContent = formatFileSize(compressedSize);
            downloadBtn.href = downloadUrl;
            downloadBtn.download = (currentFile.name || 'image').replace(/\.[^.]+$/, '') + '-compressed.' + fileExt;
            processingOverlay.style.display = 'none';
            successView.style.display = 'block';
          } catch (err) {
            console.error(err);
            processingOverlay.style.display = 'none';
            alert('Failed to compress image: ' + err.message);
            dropZone.style.display = 'block';
            editorView.style.display = 'none';
          }
        }
      }

      // ========== RESIZE VIEW ==========
      function initResizeView() {
        window.resizeInitialized = true;
        const section = document.getElementById('resizeSection');
        section.innerHTML = `<div class="resize-card" role="region" aria-live="polite">
          <div class="resize-uploader" id="resize-dropZone">
            <input id="resize-fileInput" type="file" accept="image/*" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px" aria-hidden="true" />
            <button class="btn btn-primary" id="resize-selectBtn" type="button">Select image</button>
            <div class="resize-help">or drop image here</div>
            <div class="file-limit" style="margin-top:12px;font-size:13px;color:var(--light-muted);">Max file size: 10 MB</div>
          </div>
          <div id="resize-editorView" style="display:none;max-width:900px;margin:0 auto;">
            <div id="resize-previewSection" style="text-align:center;margin-bottom:32px;">
              <img id="resize-previewImg" src="" alt="Preview" style="max-width:100%;max-height:400px;border:1px solid var(--light-border);border-radius:8px;" />
              <div id="resize-imageDimensions" style="margin-top:12px;font-size:14px;color:var(--light-muted);"></div>
            </div>
            <div class="resize-settings">
              <h2 style="font-size:24px;font-weight:700;margin-bottom:24px;">Resize Settings</h2>
              <div style="margin-bottom:28px;">
                <label for="resize-resizeMethod" style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Resize Method</label>
                <select id="resize-resizeMethod" class="form-select" style="max-width:400px;">
                  <option value="socialMedia">Social Media Preset</option>
                  <option value="bySize">Custom Size</option>
                  <option value="byPercent">By Percentage</option>
                </select>
              </div>
              <div id="resize-socialMediaOptions">
                <div style="margin-bottom:24px;">
                  <label for="resize-platformSelect" style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Choose Platform</label>
                  <select id="resize-platformSelect" class="form-select" style="max-width:400px;">
                    <option value="youtube">YouTube</option>
                    <option value="instagram">Instagram</option>
                    <option value="facebook">Facebook</option>
                    <option value="twitter">Twitter / X</option>
                    <option value="linkedin">LinkedIn</option>
                    <option value="tiktok">TikTok</option>
                    <option value="pinterest">Pinterest</option>
                  </select>
                </div>
                <div id="resize-presetTypeContainer" style="margin-bottom:24px;display:none;">
                  <label for="resize-presetTypeSelect" style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Preset Type</label>
                  <select id="resize-presetTypeSelect" class="form-select" style="max-width:400px;"></select>
                </div>
              </div>
              <div id="resize-bySizeOptions" style="display:none;">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
                  <div><label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Width (px)</label>
                  <input type="number" id="resize-widthInput" class="form-control" min="1" /></div>
                  <div><label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Height (px)</label>
                  <input type="number" id="resize-heightInput" class="form-control" min="1" /></div>
                </div>
              </div>
              <div id="resize-byPercentOptions" style="display:none;">
                <label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Resize Percentage (%)</label>
                <input type="number" id="resize-percentInput" class="form-control" value="100" min="1" max="500" style="max-width:300px;" />
              </div>
              <div id="resize-dimensionsDisplay" style="display:none;margin:24px 0;padding:20px;background:rgba(91,140,255,0.06);border:1px solid rgba(91,140,255,0.2);border-radius:10px;">
                <div style="margin-bottom:12px;font-weight:600;">âœ“ Final Dimensions</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                  <div><label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Width</label>
                  <input type="number" id="resize-finalWidthDisplay" class="form-control" readonly /></div>
                  <div><label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px;">Height</label>
                  <input type="number" id="resize-finalHeightDisplay" class="form-control" readonly /></div>
                </div>
              </div>
              <div id="resize-aspectRatioControl" style="display:none;margin-bottom:24px;">
                <input class="form-check-input" type="checkbox" id="resize-lockAspectRatio" checked />
                <label class="form-check-label" for="resize-lockAspectRatio" style="font-weight:600;margin-left:8px;">Lock Aspect Ratio</label>
              </div>
              <div style="text-align:center;margin-top:32px;">
                <button class="btn btn-primary" id="resize-exportBtn" type="button" style="font-size:18px;padding:14px 40px;">Export â†’</button>
              </div>
            </div>
            <div id="resize-processingOverlay" style="display:none;flex-direction:column;align-items:center;padding:40px;text-align:center;">
              <div style="display:inline-block;width:48px;height:48px;border:4px solid var(--primary-500);border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:16px"></div>
              <div style="font-weight:600;font-size:18px;">Resizing...</div>
            </div>
            <div id="resize-successView" style="display:none;text-align:center;margin-top:32px;">
              <div style="background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:#fff;border-radius:12px;padding:32px;margin-bottom:24px;">
                <div style="font-size:24px;font-weight:700;margin-bottom:8px;">âœ“ Image Resized!</div>
                <div style="font-size:18px;" id="resize-successDimensions"></div>
              </div>
              <div style="margin-bottom:24px;">
                <img id="resize-resizedImg" src="" alt="Resized" style="max-width:100%;max-height:500px;border:1px solid var(--light-border);border-radius:8px;" />
              </div>
              <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
                <a class="btn btn-primary" id="resize-downloadBtn" href="#" download style="font-size:16px;padding:12px 24px;">Download</a>
                <button class="btn btn-ghost" id="resize-resizeAnotherBtn" type="button" style="font-size:16px;padding:12px 24px;">Resize Another</button>
              </div>
            </div>
          </div>
        </div>`;

        // Resize functionality (simplified for brevity - includes social media presets logic)
        const API_BASE = 'https://api.imagenerd.in';
        const SOCIAL_PRESETS = {
          youtube: [{ name: 'Thumbnail (1280 Ã— 720)', width: 1280, height: 720 }],
          instagram: [{ name: 'Post Square (1080 Ã— 1080)', width: 1080, height: 1080 }],
          facebook: [{ name: 'Post (1200 Ã— 630)', width: 1200, height: 630 }],
          twitter: [{ name: 'Post (1200 Ã— 675)', width: 1200, height: 675 }],
          linkedin: [{ name: 'Post (1200 Ã— 627)', width: 1200, height: 627 }],
          tiktok: [{ name: 'Video (1080 Ã— 1920)', width: 1080, height: 1920 }],
          pinterest: [{ name: 'Pin (1000 Ã— 1500)', width: 1000, height: 1500 }]
        };

        const fileInput = document.getElementById('resize-fileInput');
        const selectBtn = document.getElementById('resize-selectBtn');
        const dropZone = document.getElementById('resize-dropZone');
        const editorView = document.getElementById('resize-editorView');
        const previewSection = document.getElementById('resize-previewSection');
        const previewImg = document.getElementById('resize-previewImg');
        const processingOverlay = document.getElementById('resize-processingOverlay');
        const successView = document.getElementById('resize-successView');
        const resizedImg = document.getElementById('resize-resizedImg');
        const downloadBtn = document.getElementById('resize-downloadBtn');
        const resizeAnotherBtn = document.getElementById('resize-resizeAnotherBtn');
        const exportBtn = document.getElementById('resize-exportBtn');
        const resizeMethod = document.getElementById('resize-resizeMethod');
        const platformSelect = document.getElementById('resize-platformSelect');
        const presetTypeContainer = document.getElementById('resize-presetTypeContainer');
        const presetTypeSelect = document.getElementById('resize-presetTypeSelect');
        const widthInput = document.getElementById('resize-widthInput');
        const heightInput = document.getElementById('resize-heightInput');
        const percentInput = document.getElementById('resize-percentInput');
        const finalWidthDisplay = document.getElementById('resize-finalWidthDisplay');
        const finalHeightDisplay = document.getElementById('resize-finalHeightDisplay');

        let currentFile = null;
        let currentBase64 = '';
        let originalWidth = 0;
        let originalHeight = 0;

        selectBtn.addEventListener('click', () => fileInput.click());
        resizeAnotherBtn.addEventListener('click', () => {
          dropZone.style.display = 'block';
          editorView.style.display = 'none';
          fileInput.value = '';
        });

        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag'));
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', () => handleFiles(fileInput.files));

        function handleFiles(list) {
          const files = Array.from(list || []).filter(f => /^image\//.test(f.type));
          if (!files.length) return;
          if (files[0].size > 10 * 1024 * 1024) {
            alert('File exceeds 10 MB');
            return;
          }
          processFile(files[0]);
        }

        async function processFile(file) {
          currentFile = file;
          currentBase64 = await fileToBase64(file);
          const img = new Image();
          img.onload = () => {
            originalWidth = img.width;
            originalHeight = img.height;
            previewImg.src = img.src;
            document.getElementById('resize-imageDimensions').textContent = `Original: ${originalWidth} Ã— ${originalHeight} px`;
            widthInput.value = originalWidth;
            heightInput.value = originalHeight;
            dropZone.style.display = 'none';
            editorView.style.display = 'block';
            previewSection.style.display = 'block';
            successView.style.display = 'none';
            updateUIForMethod();
            platformSelect.dispatchEvent(new Event('change'));
          };
          img.src = URL.createObjectURL(file);
        }

        function fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(String(reader.result).split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        resizeMethod.addEventListener('change', updateUIForMethod);

        function updateUIForMethod() {
          const method = resizeMethod.value;
          document.getElementById('resize-socialMediaOptions').style.display = method === 'socialMedia' ? 'block' : 'none';
          document.getElementById('resize-bySizeOptions').style.display = method === 'bySize' ? 'block' : 'none';
          document.getElementById('resize-byPercentOptions').style.display = method === 'byPercent' ? 'block' : 'none';
          document.getElementById('resize-aspectRatioControl').style.display = method === 'bySize' ? 'block' : 'none';
          updateDimensionsDisplay();
        }

        function updateDimensionsDisplay() {
          const method = resizeMethod.value;
          if (method === 'socialMedia') {
            const platform = platformSelect.value;
            const presetIdx = parseInt(presetTypeSelect.value || 0);
            if (SOCIAL_PRESETS[platform] && SOCIAL_PRESETS[platform][presetIdx]) {
              const preset = SOCIAL_PRESETS[platform][presetIdx];
              finalWidthDisplay.value = preset.width;
              finalHeightDisplay.value = preset.height;
              document.getElementById('resize-dimensionsDisplay').style.display = 'block';
            }
          } else if (method === 'bySize') {
            const w = parseInt(widthInput.value);
            const h = parseInt(heightInput.value);
            if (w > 0 && h > 0) {
              finalWidthDisplay.value = w;
              finalHeightDisplay.value = h;
              document.getElementById('resize-dimensionsDisplay').style.display = 'block';
            }
          } else if (method === 'byPercent') {
            const percent = parseFloat(percentInput.value);
            if (percent > 0 && originalWidth > 0) {
              finalWidthDisplay.value = Math.round(originalWidth * (percent / 100));
              finalHeightDisplay.value = Math.round(originalHeight * (percent / 100));
              document.getElementById('resize-dimensionsDisplay').style.display = 'block';
            }
          }
        }

        platformSelect.addEventListener('change', () => {
          const platform = platformSelect.value;
          if (SOCIAL_PRESETS[platform]) {
            presetTypeContainer.style.display = 'block';
            presetTypeSelect.innerHTML = '';
            SOCIAL_PRESETS[platform].forEach((preset, idx) => {
              const option = document.createElement('option');
              option.value = idx;
              option.textContent = preset.name;
              presetTypeSelect.appendChild(option);
            });
            updateDimensionsDisplay();
          }
        });

        presetTypeSelect.addEventListener('change', updateDimensionsDisplay);
        widthInput.addEventListener('input', updateDimensionsDisplay);
        heightInput.addEventListener('input', updateDimensionsDisplay);
        percentInput.addEventListener('input', updateDimensionsDisplay);

        exportBtn.addEventListener('click', async () => {
          if (!currentBase64) return;
          let targetWidth, targetHeight;
          const method = resizeMethod.value;

          if (method === 'bySize') {
            targetWidth = parseInt(widthInput.value);
            targetHeight = parseInt(heightInput.value);
          } else if (method === 'byPercent') {
            const percent = parseFloat(percentInput.value);
            targetWidth = Math.round(originalWidth * (percent / 100));
            targetHeight = Math.round(originalHeight * (percent / 100));
          } else if (method === 'socialMedia') {
            const platform = platformSelect.value;
            const presetIdx = parseInt(presetTypeSelect.value);
            const preset = SOCIAL_PRESETS[platform][presetIdx];
            targetWidth = preset.width;
            targetHeight = preset.height;
          }

          if (!targetWidth || !targetHeight) {
            alert('Invalid dimensions');
            return;
          }

          previewSection.style.display = 'none';
          document.querySelector('.resize-settings').style.display = 'none';
          processingOverlay.style.display = 'flex';

          try {
            const res = await fetchWithTimeout(API_BASE + '/resize', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ image_base64: currentBase64, width: targetWidth, height: targetHeight })
            });

            const data = await res.json();
            if (!data.resized_image_base64) throw new Error(data.error || 'Resize failed');

            const mimeType = currentFile.type || 'image/png';
            const fileExt = mimeType.split('/')[1] || 'png';
            const downloadUrl = `data:${mimeType};base64,${data.resized_image_base64}`;
            resizedImg.src = downloadUrl;
            document.getElementById('resize-successDimensions').textContent = `New size: ${targetWidth} Ã— ${targetHeight} pixels`;
            downloadBtn.href = downloadUrl;
            downloadBtn.download = `${(currentFile.name || 'image').replace(/\.[^.]+$/, '')}-${targetWidth}x${targetHeight}.${fileExt}`;
            processingOverlay.style.display = 'none';
            successView.style.display = 'block';
          } catch (err) {
            console.error(err);
            processingOverlay.style.display = 'none';
            alert('Failed to resize: ' + err.message);
            previewSection.style.display = 'block';
            document.querySelector('.resize-settings').style.display = 'block';
          }
        });
      }

      // Crop and Convert are on separate pages
      // No need for initCropView and initConvertView functions
      // Users will be redirected to crop.html and convert.html
    </script>
  </body>
  </html>
