<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Remove Background â€” ImageNerd</title>
    <meta name="description" content="Remove image backgrounds online with ImageNerd. Clean PNG cutouts from JPG and PNG in seconds. Free, fast, no signup." />
    <link rel="canonical" href="/remove-background.html" />
    <meta property="og:title" content="Remove Background â€” ImageNerd" />
    <meta property="og:description" content="Cut out image backgrounds instantly. Drag & drop, get a clean PNG, and download." />
    <meta property="og:type" content="website" />
    <meta name="robots" content="index,follow" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="index.html"><span class="brand-mark">ðŸ§ </span><span class="brand-name">ImageNerd</span></a>
        <nav class="main-nav"><a href="remove-background.html">Remove background</a><a href="compress.html">Compress</a><a href="resize.html">Resize</a><a href="crop.html">Crop</a><a href="convert.html">Format Converter</a></nav>
        <div class="header-cta"><button id="themeToggle" class="btn btn-ghost" type="button">Toggle theme</button></div>
        <button class="nav-toggle" aria-label="Toggle menu" aria-expanded="false">â˜°</button>
      </div>
    </header>
    <main class="container" style="padding:32px 0 56px;">
      <h1>Remove background</h1>
      <p class="subtitle">Cut out image background. Remove the background of your JPG and PNG images with exceptional quality.</p>

      <section id="rbx" aria-label="Background remover" style="margin-top:24px;">
        <div class="rbx-card" role="region" aria-live="polite">
          <!-- Uploader (shown initially, hidden after upload) -->
          <div class="rbx-uploader" id="dropZone">
            <input id="fileInput" type="file" accept="image/*" style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px" aria-hidden="true" />
            <button class="btn btn-primary" id="selectBtn" type="button" aria-controls="fileInput" aria-label="Select image to remove background">Select images</button>
            <div class="rbx-help">or drop images here</div>
          </div>

          <!-- Editor (hidden initially, shown after upload) -->
          <div id="editorView" style="display:none;max-width:900px;margin:0 auto;">
            <div style="text-align:center;margin-bottom:20px;position:relative">
              <!-- Image preview container -->
              <div id="imageContainer" style="position:relative;display:inline-block;max-width:100%">
                <img id="mainImg" src="" alt="Preview" style="max-width:400px;max-height:400px;width:auto;height:auto;border:1px solid var(--light-border);border-radius:8px;background:repeating-conic-gradient(#eef2f7 0% 25%, #fff 0% 50%) 50%/16px 16px;display:block" />
                
                <!-- Before/After Slider (hidden until processed) -->
                <div id="sliderContainer" style="display:none;position:relative;border:1px solid var(--light-border);border-radius:8px;overflow:hidden;max-width:400px;margin:0 auto;background:repeating-conic-gradient(#eef2f7 0% 25%, #fff 0% 50%) 50%/16px 16px">
                  <!-- After image (processed, full width at bottom) -->
                  <img id="afterImg" src="" alt="After" style="display:block;width:100%;height:auto;max-width:400px" />
                  <!-- Before image container (original, clipped overlay from left) -->
                  <div id="beforeContainer" style="position:absolute;top:0;left:0;width:50%;height:100%;overflow:hidden">
                    <img id="beforeImg" src="" alt="Before" style="display:block;object-fit:fill" />
                  </div>
                  <div id="sliderHandle" style="position:absolute;left:50%;top:0;bottom:0;width:4px;background:#fff;cursor:ew-resize;transform:translateX(-50%);box-shadow:0 0 10px rgba(0,0,0,0.3)">
                    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;background:#fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.2);display:flex;align-items:center;justify-content:center">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="color:#666">
                        <path d="M7 4L3 10L7 16M13 4L17 10L13 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                      </svg>
                    </div>
                  </div>
                  <div style="position:absolute;top:8px;left:8px;background:rgba(0,0,0,0.6);color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600">Before</div>
                  <div style="position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.6);color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600">After</div>
                </div>

                <!-- Processing overlay -->
                <div id="processingOverlay" style="display:none;position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);border-radius:8px;align-items:center;justify-content:center;color:#fff;font-weight:600">
                  <div style="text-align:center">
                    <div style="display:inline-block;width:32px;height:32px;border:4px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:8px"></div>
                    <div>Processing...</div>
                  </div>
                </div>
              </div>
              
              <div style="margin-top:16px">
                <button class="btn btn-ghost" id="changeImageBtn" type="button">Change image</button>
                <a class="btn btn-primary" id="downloadBtn" href="#" download style="display:none;margin-left:8px">Download Image</a>
              </div>
            </div>

            <h3 style="margin:0 0 12px;font-size:15px;font-weight:600;text-align:center">Select background</h3>
            <div class="rbx-gallery" id="bgGallery" aria-label="Background gallery"></div>
          </div>
        </div>
      </section>

    </main>
    <footer class="site-footer"><div class="container footer-inner"><p>Â© <span id="year"></span> ImageNerd.</p></div></footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="script.js"></script>
    <script>
      // Minimal utility styles scoped here to avoid global CSS edits
      (function(){
        var style = document.createElement('style');
        style.textContent = `
        .rbx-card{border:1px solid var(--light-border);background:var(--light-card);border-radius:14px;padding:22px}
        .rbx-uploader{border:2px dashed var(--light-border);border-radius:12px;padding:28px;text-align:center;background:rgba(15,23,42,0.02)}
        .rbx-uploader.drag{background:rgba(91,140,255,0.10);border-color:#a5b4fc}
        .rbx-help{margin-top:10px;color:var(--light-muted);font-size:14px}
        #previewImg{transition:opacity 0.3s}
        #previewImg.processing{opacity:0.5}
        .rbx-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:12px}
        .rbx-gallery-tile{position:relative;aspect-ratio:1;border:2px solid var(--light-border);border-radius:10px;cursor:pointer;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#f8fafc;transition:all 0.2s}
        .rbx-gallery-tile:hover{border-color:#a5b4fc;transform:scale(1.05)}
        .rbx-gallery-tile.selected{border-color:var(--primary-500);box-shadow:0 0 0 2px rgba(91,140,255,0.2)}
        .rbx-gallery-tile img{width:100%;height:100%;object-fit:cover}
        .rbx-gallery-tile .icon{font-size:32px}
        .rbx-gallery-tile .label{position:absolute;bottom:4px;left:0;right:0;text-align:center;font-size:11px;font-weight:600;background:rgba(255,255,255,0.9);padding:2px}
        .rbx-results{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
        .rbx-result{border:1px solid var(--light-border);border-radius:12px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
        .rbx-result h3{margin:10px 12px 0;font-size:14px;color:var(--light-muted)}
        .rbx-result img{width:100%;max-height:280px;height:280px;object-fit:contain;display:block;background:repeating-conic-gradient(#eee 0% 25%, #fff 0% 50%) 50%/20px 20px}
        .rbx-compare{display:grid;grid-template-columns:1fr 1fr;gap:0;border-top:1px solid var(--light-border)}
        .rbx-compare .pane{display:flex;align-items:center;justify-content:center;background:#fff;padding:8px}
        .rbx-compare .pane small{position:absolute;top:4px;left:4px;background:rgba(0,0,0,0.6);color:#fff;padding:2px 6px;border-radius:4px;font-size:11px}
        .rbx-row{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px}
        .rbx-progress{height:6px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:6px 10px}
        .rbx-bar{height:100%;width:0;background:var(--primary-500);transition:width 0.3s}
        .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
        @keyframes spin{to{transform:rotate(360deg)}}
        .theme-dark .rbx-card{border-color:var(--border-700);background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))}
        .theme-dark .rbx-uploader{border-color:var(--border-700);background:rgba(255,255,255,0.02)}
        .theme-dark .rbx-uploader.drag{background:rgba(91,140,255,0.15);border-color:#5b8cff}
        .theme-dark .rbx-help{color:var(--text-300)}
        .theme-dark .rbx-gallery-tile{border-color:var(--border-700);background:rgba(255,255,255,0.03)}
        .theme-dark .rbx-gallery-tile:hover{border-color:#5b8cff}
        .theme-dark .rbx-gallery-tile .label{background:rgba(0,0,0,0.8);color:var(--text-100)}
        .theme-dark .rbx-result{border-color:var(--border-700);background:rgba(255,255,255,0.02)}
        .theme-dark .rbx-result h3{color:var(--text-300)}
        .theme-dark .rbx-compare .pane{background:rgba(255,255,255,0.02)}
        .theme-dark #previewImg{border-color:var(--border-700)}
        .theme-dark #beforeImg,.theme-dark #afterImg{border-color:var(--border-700)}
        `;
        document.head.appendChild(style);
      })();

      (function(){
        const fileInput = document.getElementById('fileInput');
        const selectBtn = document.getElementById('selectBtn');
        const dropZone = document.getElementById('dropZone');
        const editorView = document.getElementById('editorView');
        const mainImg = document.getElementById('mainImg');
        const sliderContainer = document.getElementById('sliderContainer');
        const beforeImg = document.getElementById('beforeImg');
        const afterImg = document.getElementById('afterImg');
        const beforeContainer = document.getElementById('beforeContainer');
        const sliderHandle = document.getElementById('sliderHandle');
        const changeImageBtn = document.getElementById('changeImageBtn');
        const bgGallery = document.getElementById('bgGallery');
        const processingOverlay = document.getElementById('processingOverlay');
        const downloadBtn = document.getElementById('downloadBtn');

        const API_BASE = 'https://api.imagenerd.in';
        const ENDPOINT_REMOVE = '/remove-background';
        const ENDPOINT_CHANGE = '/change-background';

        // State
        let currentFile = null;
        let currentBase64 = '';
        let originalImageUrl = '';
        let selectedPreset = null;
        let processedImageBase64 = '';

        // Background presets
        const PRESETS = [
          { id: 'transparent', label: 'Transparent', icon: 'ðŸ”²', mode: 'transparent' },
          { id: 'white', label: 'White', color: '#ffffff', mode: 'solid', solid: '255,255,255' },
          { id: 'blue', label: 'Blue', color: '#3b82f6', mode: 'solid', solid: '59,130,246' },
          { id: 'gray', label: 'Gray', color: '#6b7280', mode: 'solid', solid: '107,114,128' },
          { id: 'green', label: 'Green', color: '#10b981', mode: 'solid', solid: '16,185,129' },
          { id: 'red', label: 'Red', color: '#ef4444', mode: 'solid', solid: '239,68,68' }
        ];

        // Render gallery
        PRESETS.forEach(p => {
          const tile = document.createElement('div');
          tile.className = 'rbx-gallery-tile';
          tile.dataset.id = p.id;
          if (p.color) tile.style.background = p.color;
          if (p.icon) { const icon = document.createElement('div'); icon.className='icon'; icon.textContent=p.icon; tile.appendChild(icon); }
          const lbl = document.createElement('div'); lbl.className='label'; lbl.textContent=p.label; tile.appendChild(lbl);
          tile.addEventListener('click', ()=> selectAndApply(p.id));
          bgGallery.appendChild(tile);
        });

        async function selectAndApply(id){
          if (!currentBase64) return;
          selectedPreset = PRESETS.find(p => p.id === id);
          document.querySelectorAll('.rbx-gallery-tile').forEach(t => t.classList.toggle('selected', t.dataset.id === id));
          
          // Auto-apply immediately
          await applyBackground();
        }

        selectBtn.addEventListener('click', () => fileInput.click());
        changeImageBtn.addEventListener('click', () => {
          fileInput.click();
          // Reset state when changing image
          downloadBtn.style.display = 'none';
          sliderContainer.style.display = 'none';
          mainImg.style.display = 'block';
        });

        // Slider functionality
        let isDragging = false;
        sliderHandle.addEventListener('mousedown', (e) => {
          isDragging = true;
          e.preventDefault();
        });
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          const rect = sliderContainer.getBoundingClientRect();
          const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
          const percentage = (x / rect.width) * 100;
          updateSlider(percentage);
        });
        document.addEventListener('mouseup', () => { isDragging = false; });

        // Touch support for mobile
        sliderHandle.addEventListener('touchstart', (e) => {
          isDragging = true;
          e.preventDefault();
        });
        document.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          const touch = e.touches[0];
          const rect = sliderContainer.getBoundingClientRect();
          const x = Math.max(0, Math.min(touch.clientX - rect.left, rect.width));
          const percentage = (x / rect.width) * 100;
          updateSlider(percentage);
        });
        document.addEventListener('touchend', () => { isDragging = false; });

        function updateSlider(percentage) {
          // Update beforeContainer width to show more/less of original
          // When slider is at 0% (left), show 0% before (all after/processed visible)
          // When slider is at 50% (middle), show 50% before, 50% after
          // When slider is at 100% (right), show 100% before (all original visible)
          beforeContainer.style.width = percentage + '%';
          sliderHandle.style.left = percentage + '%';
        }
        dropZone.addEventListener('dragover', (e)=>{ e.preventDefault(); dropZone.classList.add('drag'); });
        dropZone.addEventListener('dragleave', ()=> dropZone.classList.remove('drag'));
        dropZone.addEventListener('drop', (e)=>{ e.preventDefault(); dropZone.classList.remove('drag'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', ()=> handleFiles(fileInput.files));

        function handleFiles(list){
          const files = Array.from(list || [] ).filter(f=>/^image\//.test(f.type));
          if(!files.length) return;
          processFile(files[0]); // single file for now
        }

        async function processFile(file){
          currentFile = file;
          const fileUrl = URL.createObjectURL(file);
          originalImageUrl = fileUrl;
          mainImg.src = fileUrl;
          beforeImg.src = fileUrl;
          currentBase64 = await fileToBase64(file);
          // Show editor, hide uploader
          dropZone.style.display = 'none';
          editorView.style.display = 'block';
          // Reset state
          downloadBtn.style.display = 'none';
          processingOverlay.style.display = 'none';
          sliderContainer.style.display = 'none';
          mainImg.style.display = 'block';
        }

        function fileToBase64(file){
          return new Promise((resolve, reject)=>{
            const reader = new FileReader();
            reader.onload = ()=> resolve(String(reader.result).split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        async function applyBackground(){
          if (!selectedPreset || !currentBase64) return;
          
          // Show processing overlay
          processingOverlay.style.display = 'flex';
          downloadBtn.style.display = 'none';

          try{
            let endpoint = ENDPOINT_REMOVE;
            let body = { image_base64: currentBase64 };
            if (selectedPreset.mode === 'solid') {
              endpoint = ENDPOINT_CHANGE;
              body = { image_base64: currentBase64, solid_color: selectedPreset.solid };
            }

            const res = await fetch(API_BASE + endpoint, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
            const data = await res.json();
            const out = data.image_without_background_base64 || data.image_base64;
            if(!out) throw new Error(data.error || 'Processing failed');

            // Store processed image
            processedImageBase64 = out;
            
            // Use format from backend response, fallback to transparent check
            const format = data.format || (selectedPreset.mode === 'transparent' ? 'png' : 'jpeg');
            const fileExt = format === 'png' ? 'png' : 'jpg';
            const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            
            // Set up slider with before/after images
            const downloadUrl = `data:${mimeType};base64,${out}`;
            
            // Set images - After is base (processed on bottom), Before is overlay (original on top)
            afterImg.src = downloadUrl; // Processed image (full width, base layer)
            beforeImg.src = originalImageUrl; // Original image (clipped overlay from left)
            
            // Wait for both images to load, then show slider
            let imagesLoaded = 0;
            const checkLoaded = () => {
              imagesLoaded++;
              if (imagesLoaded === 2) {
                // Hide main image, show slider FIRST so we can get dimensions
                mainImg.style.display = 'none';
                sliderContainer.style.display = 'block';
                
                // Now get the actual rendered dimensions after display is set
                // Use setTimeout to ensure rendering has completed
                setTimeout(() => {
                  const containerWidth = sliderContainer.offsetWidth;
                  const containerHeight = afterImg.offsetHeight;
                  
                  // Make beforeImg exactly the same size as afterImg
                  beforeImg.style.width = containerWidth + 'px';
                  beforeImg.style.height = containerHeight + 'px';
                  
                  updateSlider(50); // Start at 50%
                }, 10);
              }
            };
            
            beforeImg.onload = checkLoaded;
            afterImg.onload = checkLoaded;
            
            // Show download button
            downloadBtn.href = downloadUrl;
            downloadBtn.download = (currentFile.name||'image').replace(/\.[^.]+$/, '') + '-' + selectedPreset.id + '.' + fileExt;
            
            processingOverlay.style.display = 'none';
            downloadBtn.style.display = 'inline-block';
          }catch(err){
            console.error(err);
            processingOverlay.style.display = 'none';
            alert('Failed to process image: ' + err.message);
          }
        }
      })();
    </script>
  </body>
  </html>


